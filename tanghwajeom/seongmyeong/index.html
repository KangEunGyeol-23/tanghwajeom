<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎãπÌôî - ÏÑ±Î™ÖÌïô</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        // Í∞ÑÏßÄÏùò Ïò§Ìñâ Î≥ÄÌôò Ìï®Ïàò
        
        // ÏÉàÎ°úÏö¥ Î∂ÑÏÑùÏùÑ ÏúÑÌï¥ ÏûÖÎ†• Ï∞Ω Îã§Ïãú Î≥¥Ïù¥Í∏∞
        
        body {
            font-family: 'Georgia', serif;
            background: #ffffff;
            min-height: 100vh;
            color: #000000;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .title {
            font-size: 3em;
            font-weight: 900;
            color: #000000;
            margin-bottom: 10px;
            letter-spacing: 3px;
        }
        
        .subtitle {
            font-size: 1.1em;
            color: #333333;
            letter-spacing: 2px;
        }
        
        .input-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.5s ease;
        }
        
        .input-section.hidden {
            opacity: 0;
            visibility: hidden;
            height: 0;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-group label {
            display: block;
            font-size: 1.1em;
            color: #000000;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .input-group input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1em;
            background: #ffffff;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            color: #000000;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.2);
        }
        
        .analyze-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.2em;
            font-weight: bold;
            background: #007bff;
            border: none;
            border-radius: 12px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .analyze-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }
        
        .result {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            transition: all 0.5s ease;
        }
        
        .new-analysis-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.2em;
            font-weight: bold;
            background: #28a745;
            border: none;
            border-radius: 12px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            margin-top: 20px;
        }
        
        .new-analysis-btn:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .result-title {
            text-align: center;
            font-size: 1.8em;
            color: #000000;
            font-weight: bold;
            margin-bottom: 30px;
        }
        
        .ganzi-info {
            text-align: center;
            font-size: 1.3em;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .char-analysis {
            margin-bottom: 40px;
            background: #ffffff;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .char-title {
            font-size: 1.4em;
            color: #000000;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        .char-details {
            display: none;
            gap: 15px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .char-details.show {
            display: grid;
        }
        
        .detail-toggle {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .detail-toggle:hover {
            background: #0056b3;
        }
        
        .detail-toggle.active {
            background: #28a745;
        }
        
        .sipseong-line-single {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            font-size: 1.2em;
            font-weight: 900;
            text-align: center;
        }
        
        .char-center-only {
            color: #000000;
            font-size: 1.5em;
            font-weight: 900;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .detail-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4ECDC4;
        }
        
        .sipseong-result {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .sipseong-line {
            display: grid;
            grid-template-columns: 1fr 2fr 2fr 2fr 1fr;
            align-items: center;
            margin-bottom: 10px;
            font-size: 1.2em;
            font-weight: 900;
            text-align: center;
        }
        
        .sipseong-line:last-child {
            margin-bottom: 0;
        }
        
        .sipseong-number {
            color: #d32f2f;
            font-size: 1.4em;
            font-weight: 900;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .sipseong-name {
            color: #1976d2;
            font-weight: 900;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .char-center {
            color: #000000;
            font-size: 1.5em;
            font-weight: 900;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .sipseong-table {
            display: none;
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: #ffffff;
            border: 2px solid #007bff;
            border-radius: 20px;
            color: #007bff;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .back-btn:hover {
            background: #007bff;
            color: #ffffff;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-btn">‚Üê ÎèåÏïÑÍ∞ÄÍ∏∞</a>
    
    <div class="container">
        <div class="input-section" id="inputSection">
            <div class="header">
                <h1 class="title">üîÆ ÏÑ±Î™ÖÌïô Î∂ÑÏÑù</h1>
                <p class="subtitle">Ïù¥Î¶ÑÍ≥º ÏÉùÎÖÑÏõîÏùºÎ°ú Ïö¥Î™ÖÏùÑ ÏùΩÎã§</p>
            </div>
            
            <div class="input-group">
                <label for="nameInput">Ïù¥Î¶Ñ</label>
                <input type="text" id="nameInput" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: ÌôçÍ∏∏Îèô)">
            </div>
            
            <div class="input-group">
                <label for="yearInput">ÌÉúÏñ¥ÎÇú ÎÖÑÎèÑ</label>
                <input type="number" id="yearInput" placeholder="ÎÖÑÎèÑÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: 1979)">
            </div>
            
            <button class="analyze-btn" onclick="analyzeName()">üåü ÏÑ±Î™ÖÌïô Î∂ÑÏÑùÌïòÍ∏∞</button>
        </div>
        
        <div id="result"></div>
    </div>

    <script>
        // ÏûêÏùå ÌöçÏàò (ÎãπÏã†Ïùò ÏãúÏä§ÌÖú)
        const consonantStrokes = {
            '„Ñ±': 1, '„Ñ¥': 1, '„Ñ∑': 2, '„Ñπ': 3, '„ÖÅ': 3, '„ÖÇ': 4, '„ÖÖ': 2,
            '„Öá': 1, '„Öà': 3, '„Öä': 4, '„Öã': 2, '„Öå': 3, '„Öç': 4, '„Öé': 3,
            '„Ñ≤': 2, '„Ñ∏': 4, '„ÖÉ': 8, '„ÖÜ': 4, '„Öâ': 6
        };
        
        // Î™®Ïùå ÌöçÏàò (ÌöçÏàú Í∏∞Ï§Ä)
        const vowelStrokes = {
            '„Öè': 2, '„Öë': 3, '„Öì': 2, '„Öï': 3, '„Öó': 2, '„Öõ': 3, 
            '„Öú': 2, '„Ö†': 3, '„Ö°': 1, '„Ö£': 1, '„Öê': 3, '„Öí': 4, 
            '„Öî': 3, '„Öñ': 4, '„Öò': 4, '„Öô': 5, '„Öö': 4, '„Öù': 4, 
            '„Öû': 5, '„Öü': 4, '„Ö¢': 2
        };
        
        // ÏûêÏùå ‚Üí Ïò§Ìñâ Î∂ÑÎ•ò
        const consonantToElement = {
            '„Ñ±': 'Êú®', '„Öã': 'Êú®',
            '„Ñ¥': 'ÁÅ´', '„Ñ∑': 'ÁÅ´', '„Ñπ': 'ÁÅ´', '„Öå': 'ÁÅ´',
            '„Öá': 'Âúü', '„Öé': 'Âúü',
            '„ÖÖ': 'Èáë', '„Öà': 'Èáë', '„Öä': 'Èáë',
            '„ÖÅ': 'Ê∞¥', '„ÖÇ': 'Ê∞¥', '„Öç': 'Ê∞¥',
            '„Ñ≤': 'Êú®', '„Ñ∏': 'ÁÅ´', '„ÖÉ': 'Ê∞¥', '„ÖÜ': 'Èáë', '„Öâ': 'Èáë'
        };
        
        // Ïò§ÌñâÎ≥Ñ Ï≤úÍ∞Ñ (ÏñëÏùå)
        const elementToCheongan = {
            'Êú®': ['Áî≤', '‰πô'],  // [Ïñë, Ïùå]
            'ÁÅ´': ['‰∏ô', '‰∏Å'],
            'Âúü': ['Êàä', 'Â∑±'],
            'Èáë': ['Â∫ö', 'Ëæõ'],
            'Ê∞¥': ['Â£¨', 'Áô∏']
        };
        
        // Ïã≠ÏÑ± Ïù¥Î¶Ñ
        const sipseongNames = [
            'Ï†ïÏù∏', 'ÎπÑÍ≤¨', 'Í≤ÅÏû¨', 'ÏãùÏã†', 'ÏÉÅÍ¥Ä', 'Ìé∏Ïû¨', 'Ï†ïÏû¨', 'Ìé∏Í¥Ä', 'Ï†ïÍ¥Ä', 'Ìé∏Ïù∏'
        ];
        
        // ÌïúÍ∏Ä Î∂ÑÌï¥ Ìï®Ïàò
        function hangulDecompose(char) {
            const charCode = char.charCodeAt(0);
            if (charCode < 0xAC00 || charCode > 0xD7A3) return null;
            
            const index = charCode - 0xAC00;
            const initial = Math.floor(index / 588);
            const medial = Math.floor((index % 588) / 28);
            const final = index % 28;
            
            const initials = ['„Ñ±','„Ñ≤','„Ñ¥','„Ñ∑','„Ñ∏','„Ñπ','„ÖÅ','„ÖÇ','„ÖÉ','„ÖÖ','„ÖÜ','„Öá','„Öà','„Öâ','„Öä','„Öã','„Öå','„Öç','„Öé'];
            const medials = ['„Öè','„Öê','„Öë','„Öí','„Öì','„Öî','„Öï','„Öñ','„Öó','„Öò','„Öô','„Öö','„Öõ','„Öú','„Öù','„Öû','„Öü','„Ö†','„Ö°','„Ö¢','„Ö£'];
            const finals = ['','„Ñ±','„Ñ≤','„Ñ±„ÖÖ','„Ñ¥','„Ñ¥„Öà','„Ñ¥„Öé','„Ñ∑','„Ñπ','„Ñπ„Ñ±','„Ñπ„ÖÅ','„Ñπ„ÖÇ','„Ñπ„ÖÖ','„Ñπ„Öå','„Ñπ„Öç','„Ñπ„Öé','„ÖÅ','„ÖÇ','„ÖÇ„ÖÖ','„ÖÖ','„ÖÜ','„Öá','„Öà','„Öä','„Öã','„Öå','„Öç','„Öé'];
            
            return {
                initial: initials[initial],
                medial: medials[medial],
                final: final === 0 ? '' : finals[final]
            };
        }
        
        // Í∞ÑÏßÄ Í≥ÑÏÇ∞ (ÏàòÏ†ïÎê®)
        function getGanJi(year) {
            const gan = ['Í∞ë', 'ÏùÑ', 'Î≥ë', 'Ï†ï', 'Î¨¥', 'Í∏∞', 'Í≤Ω', 'Ïã†', 'ÏûÑ', 'Í≥Ñ'];
            const ji = ['Ïûê', 'Ï∂ï', 'Ïù∏', 'Î¨ò', 'ÏßÑ', 'ÏÇ¨', 'Ïò§', 'ÎØ∏', 'Ïã†', 'Ïú†', 'Ïà†', 'Ìï¥'];
            const ganHanja = ['Áî≤', '‰πô', '‰∏ô', '‰∏Å', 'Êàä', 'Â∑±', 'Â∫ö', 'Ëæõ', 'Â£¨', 'Áô∏'];
            const jiHanja = ['Â≠ê', '‰∏ë', 'ÂØÖ', 'ÂçØ', 'Ëæ∞', 'Â∑≥', 'Âçà', 'Êú™', 'Áî≥', 'ÈÖâ', 'Êàå', '‰∫•'];
            
            // 1984ÎÖÑÏù¥ Í∞ëÏûêÎÖÑ(Áî≤Â≠ê)ÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Í≥ÑÏÇ∞
            const baseYear = 1984;
            const yearDiff = year - baseYear;
            
            let ganIndex = yearDiff % 10;
            let jiIndex = yearDiff % 12;
            
            // ÏùåÏàò Ï≤òÎ¶¨
            if (ganIndex < 0) ganIndex += 10;
            if (jiIndex < 0) jiIndex += 12;
            
            return {
                ganKorean: gan[ganIndex],
                jiKorean: ji[jiIndex],
                ganHanja: ganHanja[ganIndex],
                jiHanja: jiHanja[jiIndex],
                fullKorean: gan[ganIndex] + ji[jiIndex] + 'ÎÖÑ',
                fullHanja: ganHanja[ganIndex] + jiHanja[jiIndex]
            };
        }
        
        // Ïã≠ÏÑ± Í≥ÑÏÇ∞
        function calculateSipseong(myElement, targetElement) {
            // ÏïàÏ†ÑÌïú Î¨∏ÏûêÏó¥ Ï≤òÎ¶¨
            if (!myElement || !targetElement || myElement.length < 2 || targetElement.length < 2) {
                return 0;
            }
            
            // Ïò§Ìñâ Í¥ÄÍ≥Ñ ÌôïÏù∏
            const relations = {
                'Êú®': { generates: 'ÁÅ´', destroys: 'Âúü', generatedBy: 'Ê∞¥', destroyedBy: 'Èáë' },
                'ÁÅ´': { generates: 'Âúü', destroys: 'Èáë', generatedBy: 'Êú®', destroyedBy: 'Ê∞¥' },
                'Âúü': { generates: 'Èáë', destroys: 'Ê∞¥', generatedBy: 'ÁÅ´', destroyedBy: 'Êú®' },
                'Èáë': { generates: 'Ê∞¥', destroys: 'Êú®', generatedBy: 'Âúü', destroyedBy: 'ÁÅ´' },
                'Ê∞¥': { generates: 'Êú®', destroys: 'ÁÅ´', generatedBy: 'Èáë', destroyedBy: 'Âúü' }
            };
            
            const myElementType = myElement.charAt(0); // Ïò§Ìñâ
            const myYinYang = myElement.charAt(1); // ÏùåÏñë (+/-)
            const targetElementType = targetElement.charAt(0);
            const targetYinYang = targetElement.charAt(1);
            
            // Ïò§ÌñâÏù¥ Ïú†Ìö®ÌïúÏßÄ ÌôïÏù∏
            if (!relations[myElementType] || !relations[targetElementType]) {
                return 0;
            }
            
            const sameYinYang = myYinYang === targetYinYang;
            
            // Ïã≠ÏÑ± ÌåêÎã®
            if (myElementType === targetElementType) {
                return sameYinYang ? 1 : 2; // ÎπÑÍ≤¨ : Í≤ÅÏû¨
            } else if (relations[myElementType].generates === targetElementType) {
                return sameYinYang ? 3 : 4; // ÏãùÏã† : ÏÉÅÍ¥Ä
            } else if (relations[myElementType].destroys === targetElementType) {
                return sameYinYang ? 5 : 6; // Ìé∏Ïû¨ : Ï†ïÏû¨
            } else if (relations[myElementType].destroyedBy === targetElementType) {
                return sameYinYang ? 7 : 8; // Ìé∏Í¥Ä : Ï†ïÍ¥Ä
            } else if (relations[myElementType].generatedBy === targetElementType) {
                return sameYinYang ? 9 : 0; // Ìé∏Ïù∏ : Ï†ïÏù∏
            }
            
            return 0;
        }
        
        // Ï≤úÍ∞Ñ Î≥ÄÌôò (Ïò§Ìñâ + ÏùåÏñë ‚Üí Ï≤úÍ∞ÑÌïúÏûê)
        function getCheonganHanja(element, isPositive) {
            const cheongans = elementToCheongan[element];
            return isPositive ? cheongans[0] : cheongans[1];
        }
        
        // ÌååÏÉùÏàò Í≥ÑÏÇ∞ Ìï®Ïàò (ÎîîÎ≤ÑÍπÖ Ï∂îÍ∞Ä)
        function calculateDerived(sipseong1, sipseong2) {
            // Ïù¥ Ìï®ÏàòÎäî Îçî Ïù¥ÏÉÅ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå (Ïù¥Î¶Ñ Ï∂©Îèå Î∞©ÏßÄ)
            return '';
        }
        function getElementFromHanja(hanja) {
            const hanjaToElement = {
                // Ï≤úÍ∞Ñ
                'Áî≤': 'Êú®', '‰πô': 'Êú®',
                '‰∏ô': 'ÁÅ´', '‰∏Å': 'ÁÅ´', 
                'Êàä': 'Âúü', 'Â∑±': 'Âúü',
                'Â∫ö': 'Èáë', 'Ëæõ': 'Èáë',
                'Â£¨': 'Ê∞¥', 'Áô∏': 'Ê∞¥',
                // ÏßÄÏßÄ
                'Â≠ê': 'Ê∞¥', '‰∏ë': 'Âúü', 'ÂØÖ': 'Êú®', 'ÂçØ': 'Êú®', 
                'Ëæ∞': 'Âúü', 'Â∑≥': 'ÁÅ´', 'Âçà': 'ÁÅ´', 'Êú™': 'Âúü',
                'Áî≥': 'Èáë', 'ÈÖâ': 'Èáë', 'Êàå': 'Âúü', '‰∫•': 'Ê∞¥'
            };
            return hanjaToElement[hanja] || 'Âúü';
        }
        
        function analyzeName() {
            const name = document.getElementById('nameInput').value.trim();
            const year = parseInt(document.getElementById('yearInput').value);
            
            if (!name || !year) {
                alert('Ïù¥Î¶ÑÍ≥º ÌÉúÏñ¥ÎÇú ÎÖÑÎèÑÎ•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // ÏûÖÎ†• ÏÑπÏÖò Ïà®Í∏∞Í∏∞ (ÏïàÏ†ÑÌïú Ï≤¥ÌÅ¨)
            const inputSection = document.getElementById('inputSection');
            if (inputSection) {
                inputSection.classList.add('hidden');
            }
            
            const ganJi = getGanJi(year);
            
            let resultHTML = `
                <div class="result-title">üîÆ ${name}ÎãòÏùò ÏÑ±Î™ÖÌïô Î∂ÑÏÑù Í≤∞Í≥º</div>
                <div class="ganzi-info">
                    <strong>ÌÉúÏñ¥ÎÇú Ìï¥:</strong> ${year}ÎÖÑ ${ganJi.fullKorean} (${ganJi.fullHanja})
                </div>
            `;
            
            // Í∞Å Í∏ÄÏûê Î∂ÑÏÑù
            for (let i = 0; i < name.length; i++) {
                const char = name[i];
                const decomposed = hangulDecompose(char);
                
                if (!decomposed) continue;
                
                const {initial, medial, final} = decomposed;
                
                // Ï¥ù ÌöçÏàò Í≥ÑÏÇ∞
                let totalStrokes = 0;
                totalStrokes += consonantStrokes[initial] || 0;
                totalStrokes += vowelStrokes[medial] || 0;
                if (final) totalStrokes += consonantStrokes[final] || 0;
                
                // ÏùåÏñë Í≤∞Ï†ï
                const isPositive = totalStrokes % 2 === 1;
                const yinYangSymbol = isPositive ? '+' : '-';
                const yinYangName = isPositive ? 'Ïñë' : 'Ïùå';
                
                // ÏûêÏùåÎì§Ïùò Ï≤úÍ∞Ñ Î≥ÄÌôò (Î™®Îì† ÏûêÏùå Ìè¨Ìï®)
                const consonants = [initial];
                if (final && final !== '') {
                    consonants.push(final);
                }
                
                let charHTML = `
                    <div class="char-analysis">
                        <button class="detail-toggle" onclick="toggleDetails('${char}-${i}')">
                            üîç "${char}" Î∂ÑÏÑù (${totalStrokes}Ìöç - ${yinYangName}) ÏûêÏùå Î∂ÑÌï¥ Í≥ºÏ†ï Î≥¥Í∏∞
                        </button>
                        <div class="char-details" id="details-${char}-${i}">
                `;
                
                const cheonganList = [];
                
                consonants.forEach(consonant => {
                    const element = consonantToElement[consonant];
                    if (element) {
                        const cheonganHanja = getCheonganHanja(element, isPositive);
                        cheonganList.push(cheonganHanja);
                        
                        charHTML += `
                            <div class="detail-item">
                                <strong>${consonant}</strong> ‚Üí ${element}${yinYangSymbol} ‚Üí ${cheonganHanja}
                            </div>
                        `;
                    }
                });
                
                charHTML += '</div>';
                
                // Ïã≠ÏÑ± Í≥ÑÏÇ∞
                if (cheonganList.length > 0) {
                    charHTML += '<div class="sipseong-result">';
                    
                    if (cheonganList.length === 1) {
                        // ÏûêÏùå 1Í∞úÏù∏ Í≤ΩÏö∞: 2Ï§Ñ ÌëúÏãú (Í∏ÄÏûê + Ï≤úÍ∞Ñ)
                        const cheongan = cheonganList[0];
                        const ganElement = getElementFromHanja(ganJi.ganHanja);
                        const jiElement = getElementFromHanja(ganJi.jiHanja);
                        
                        const ganYinYang = ['Áî≤','‰∏ô','Êàä','Â∫ö','Â£¨'].includes(ganJi.ganHanja) ? '+' : '-';
                        const jiYinYang = ['Â≠ê','ÂØÖ','Ëæ∞','Âçà','Áî≥','Êàå'].includes(ganJi.jiHanja) ? '-' : '+';  // ÏßÄÏßÄ ÏùåÏñë ÏàòÏ†ï
                        
                        const myCheonganElement = getElementFromHanja(cheongan);
                        
                        const ganSipseong = calculateSipseong(
                            myCheonganElement + yinYangSymbol, 
                            ganElement + ganYinYang
                        );
                        const jiSipseong = calculateSipseong(
                            myCheonganElement + yinYangSymbol,
                            jiElement + jiYinYang
                        );
                        
                        // Ï≤´ Î≤àÏß∏ Ï§Ñ: Í∏ÄÏûêÏôÄ Ïã≠ÏÑ±
                        charHTML += `
                            <div class="sipseong-line">
                                <span class="sipseong-number">${ganSipseong}</span>
                                <span class="sipseong-name">${sipseongNames[ganSipseong]}</span>
                                <span class="char-center">${char}</span>
                                <span class="sipseong-name">${sipseongNames[jiSipseong]}</span>
                                <span class="sipseong-number">${jiSipseong}</span>
                            </div>
                        `;
                        
                        // Îëê Î≤àÏß∏ Ï§Ñ: Ï≤úÍ∞ÑÎßå (Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨)
                        charHTML += `
                            <div class="sipseong-line-single">
                                <span class="char-center-only">${cheongan}</span>
                            </div>
                        `;
                    } else {
                        // ÏûêÏùå 2Í∞úÏù∏ Í≤ΩÏö∞: Í∞ÅÍ∞Å Îã§Î•∏ Ïã≠ÏÑ±ÏúºÎ°ú 2Ï§Ñ ÌëúÏãú
                        
                        // Ï≤´ Î≤àÏß∏ ÏûêÏùåÏúºÎ°ú Ïã≠ÏÑ± Í≥ÑÏÇ∞
                        const firstCheongan = cheonganList[0];
                        const firstElement = getElementFromHanja(firstCheongan);
                        const ganElement = getElementFromHanja(ganJi.ganHanja);
                        const jiElement = getElementFromHanja(ganJi.jiHanja);
                        
                        const ganYinYang = ['Áî≤','‰∏ô','Êàä','Â∫ö','Â£¨'].includes(ganJi.ganHanja) ? '+' : '-';
                        const jiYinYang = ['Â≠ê','ÂØÖ','Ëæ∞','Âçà','Áî≥','Êàå'].includes(ganJi.jiHanja) ? '-' : '+';  // ÏßÄÏßÄ ÏùåÏñë ÏàòÏ†ï
                        
                        const firstGanSipseong = calculateSipseong(
                            firstElement + yinYangSymbol, 
                            ganElement + ganYinYang
                        );
                        const firstJiSipseong = calculateSipseong(
                            firstElement + yinYangSymbol,
                            jiElement + jiYinYang
                        );
                        
                        // Îëê Î≤àÏß∏ ÏûêÏùåÏúºÎ°ú Ïã≠ÏÑ± Í≥ÑÏÇ∞
                        const secondCheongan = cheonganList[1];
                        const secondElement = getElementFromHanja(secondCheongan);
                        
                        const secondGanSipseong = calculateSipseong(
                            secondElement + yinYangSymbol, 
                            ganElement + ganYinYang
                        );
                        const secondJiSipseong = calculateSipseong(
                            secondElement + yinYangSymbol,
                            jiElement + jiYinYang
                        );
                        
                        // Ï≤´ Î≤àÏß∏ Ï§Ñ: Í∏ÄÏûê + Ï≤´ Î≤àÏß∏ ÏûêÏùå Ïã≠ÏÑ±
                        charHTML += `
                            <div class="sipseong-line">
                                <span class="sipseong-number">${firstGanSipseong}</span>
                                <span class="sipseong-name">${sipseongNames[firstGanSipseong]}</span>
                                <span class="char-center">${char}</span>
                                <span class="sipseong-name">${sipseongNames[firstJiSipseong]}</span>
                                <span class="sipseong-number">${firstJiSipseong}</span>
                            </div>
                        `;
                        
                        // Îëê Î≤àÏß∏ Ï§Ñ: Ï≤úÍ∞ÑÎì§ + Îëê Î≤àÏß∏ ÏûêÏùå Ïã≠ÏÑ±
                        charHTML += `
                            <div class="sipseong-line">
                                <span class="sipseong-number">${secondGanSipseong}</span>
                                <span class="sipseong-name">${sipseongNames[secondGanSipseong]}</span>
                                <span class="char-center">${cheonganList.join('')}</span>
                                <span class="sipseong-name">${sipseongNames[secondJiSipseong]}</span>
                                <span class="sipseong-number">${secondJiSipseong}</span>
                            </div>
                        `;
                    }
                    
                    charHTML += '</div>';
                }
                
                charHTML += '</div>';
                resultHTML += charHTML;
            }
            
            // ÏÉàÎ°úÏö¥ Î∂ÑÏÑù Î≤ÑÌäº Ï∂îÍ∞Ä
            resultHTML += `
                <button class="new-analysis-btn" onclick="newAnalysis()">
                    üîÑ ÏÉàÎ°úÏö¥ Î∂ÑÏÑùÌïòÍ∏∞
                </button>
            `;
            
            // ÏÉàÎ°úÏö¥ Î∂ÑÏÑù Î≤ÑÌäºÍ≥º ÌååÏÉùÏàò Î≤ÑÌäº Ï∂îÍ∞Ä
            resultHTML += `
                <div style="text-align: center; margin-top: 30px;">
                    <button class="derived-toggle" onclick="toggleDerived()">
                        üî¢ ÌååÏÉùÏàò Î≥¥Í∏∞/Ïà®Í∏∞Í∏∞
                    </button>
                    <button class="new-analysis-btn" onclick="newAnalysis()">
                        üîÑ ÏÉàÎ°úÏö¥ Î∂ÑÏÑùÌïòÍ∏∞
                    </button>
                </div>
            `;
            
            document.getElementById('result').innerHTML = resultHTML;
            
            // ÌååÏÉùÏàò ÎØ∏Î¶¨ Í≥ÑÏÇ∞Ìï¥ÎÜìÍ∏∞
            setTimeout(() => {
                calculateDerived(name);
            }, 100);
            
            document.getElementById('result').scrollIntoView({behavior: 'smooth'});
        }
        
        // ÌååÏÉùÏàò ÌÜ†Í∏Ä Ìï®Ïàò
        function toggleDerived() {
            const derivedRows = document.querySelectorAll('.derived-row');
            const toggleButton = document.querySelector('.derived-toggle');
            
            derivedRows.forEach(row => {
                if (row.classList.contains('show')) {
                    row.classList.remove('show');
                } else {
                    row.classList.add('show');
                }
            });
            
            if (toggleButton.classList.contains('active')) {
                toggleButton.classList.remove('active');
                toggleButton.textContent = 'üî¢ ÌååÏÉùÏàò Î≥¥Í∏∞/Ïà®Í∏∞Í∏∞';
            } else {
                toggleButton.classList.add('active');
                toggleButton.textContent = 'üìÅ ÌååÏÉùÏàò Ïà®Í∏∞Í∏∞';
            }
        }
        
        // ÌååÏÉùÏàò Í≥ÑÏÇ∞ Î∞è Ï†ÄÏû•
        function calculateDerived(name) {
            console.log('ÌååÏÉùÏàò Í≥ÑÏÇ∞ ÏãúÏûë:', name);
            
            // Î™®Îì† Í∏ÄÏûê ÏöîÏÜå Ï∞æÍ∏∞
            const charElements = document.querySelectorAll('[data-char]');
            console.log('Ï∞æÏùÄ Í∏ÄÏûê ÏöîÏÜå:', charElements.length);
            
            charElements.forEach((element, index) => {
                console.log(`ÏöîÏÜå ${index}: ${element.getAttribute('data-char')}`);
            });
            
            for (let i = 0; i < name.length - 1; i++) {
                const currentChar = name[i];
                const nextChar = name[i + 1];
                
                console.log(`Î∂ÑÏÑù: ${currentChar} ‚Üí ${nextChar}`);
                
                // Î∞∞Ïó¥Î°ú Î≥ÄÌôòÌï¥ÏÑú Ï∞æÍ∏∞
                const charArray = Array.from(charElements);
                const currentElement = charArray.find(el => el.getAttribute('data-char') === currentChar);
                const nextElement = charArray.find(el => el.getAttribute('data-char') === nextChar);
                
                console.log('ÌòÑÏû¨ ÏöîÏÜå:', currentElement);
                console.log('Îã§Ïùå ÏöîÏÜå:', nextElement);
                
                if (currentElement && nextElement) {
                    const currentSipseong = parseInt(currentElement.getAttribute('data-last-sipseong'));
                    const nextSipseong = parseInt(nextElement.getAttribute('data-first-sipseong'));
                    
                    console.log(`Ïã≠ÏÑ±: ${currentSipseong} ‚Üí ${nextSipseong}`);
                    
                    const derived = calculateDerivedNumber(currentSipseong, nextSipseong);
                    
                    if (derived) {
                        console.log(`ÌååÏÉùÏàò Î∞úÍ≤¨: ${derived}`);
                        
                        // ÌååÏÉùÏàò ÌëúÏãú
                        const currentDerived = document.querySelector(`#derived-${currentChar}-${i}`);
                        const nextDerived = document.querySelector(`#derived-${nextChar}-${i+1}`);
                        
                        console.log('ÌòÑÏû¨ ÌååÏÉùÏàò div:', currentDerived);
                        console.log('Îã§Ïùå ÌååÏÉùÏàò div:', nextDerived);
                        
                        if (currentDerived) {
                            const rightSpan = currentDerived.querySelector('.derived-right');
                            if (rightSpan) {
                                rightSpan.textContent = derived;
                                console.log(`${currentChar} Ïò§Î•∏Ï™ΩÏóê ${derived} ÏÑ§Ï†ï`);
                            }
                        }
                        
                        if (nextDerived) {
                            const leftSpan = nextDerived.querySelector('.derived-left');
                            if (leftSpan) {
                                leftSpan.textContent = derived;
                                console.log(`${nextChar} ÏôºÏ™ΩÏóê ${derived} ÏÑ§Ï†ï`);
                            }
                        }
                    }
                }
            }
        }
        
        // ÌååÏÉùÏàò Í≥ÑÏÇ∞ Ìï®Ïàò Ïù¥Î¶Ñ Î≥ÄÍ≤Ω (Ï∂©Îèå Î∞©ÏßÄ)
        function calculateDerivedNumber(sipseong1, sipseong2) {
            console.log(`ÌååÏÉùÏàò Í≥ÑÏÇ∞: ${sipseong1} ‚Üí ${sipseong2}`);
            
            // Í∑π Í¥ÄÍ≥Ñ ÌôïÏù∏ Î∞è ÌååÏÉùÏàò Í≥ÑÏÇ∞
            const derivedMap = {
                '1-5': 'P9,0', '2-6': 'P9,0', '1-6': 'P9,0', '2-5': 'P9,0',
                '5-9': 'P3,4', '6-0': 'P3,4', '5-0': 'P3,4', '6-9': 'P3,4',
                '9-3': 'P7,8', '0-4': 'P7,8', '9-4': 'P7,8', '0-3': 'P7,8',
                '3-7': 'P1,2', '4-8': 'P1,2', '3-8': 'P1,2', '4-7': 'P1,2',
                '7-1': 'P5,6', '8-2': 'P5,6', '7-2': 'P5,6', '8-1': 'P5,6'
            };
            
            const key = sipseong1 + '-' + sipseong2;
            const result = derivedMap[key] || '';
            
            console.log(`ÌÇ§: ${key}, Í≤∞Í≥º: ${result}`);
            return result;
        }
        
        // Ï†ÑÏ≤¥ ÌååÏÉùÏàò Í≥ÑÏÇ∞ Ìï®Ïàò (Í∞ïÌôîÎêú ÎîîÎ≤ÑÍπÖ)
        function calculateAllDerived(name) {
            console.log('=== ÌååÏÉùÏàò Í≥ÑÏÇ∞ ÏãúÏûë ===');
            console.log('Ïù¥Î¶Ñ:', name);
            
            setTimeout(() => {
                for (let i = 0; i < name.length - 1; i++) {
                    const currentChar = name[i];
                    const nextChar = name[i + 1];
                    
                    console.log(`\n${i+1}Î≤àÏß∏ ÎπÑÍµê: ${currentChar} ‚Üí ${nextChar}`);
                    
                    // ÌÖåÏù¥Î∏î Ï∞æÍ∏∞
                    const currentTable = document.querySelector(`[id="${currentChar}-${i}"]`);
                    const nextTable = document.querySelector(`[id="${nextChar}-${i+1}"]`);
                    
                    console.log('ÌòÑÏû¨ ÌÖåÏù¥Î∏î:', currentTable);
                    console.log('Îã§Ïùå ÌÖåÏù¥Î∏î:', nextTable);
                    
                    if (currentTable && nextTable) {
                        const currentRows = currentTable.querySelectorAll('tr');
                        const nextRows = nextTable.querySelectorAll('tr');
                        
                        console.log('ÌòÑÏû¨ Ìñâ Ïàò:', currentRows.length);
                        console.log('Îã§Ïùå Ìñâ Ïàò:', nextRows.length);
                        
                        if (currentRows.length > 1 && nextRows.length > 1) {
                            // ÎßàÏßÄÎßâ Îç∞Ïù¥ÌÑ∞ ÌñâÏùò Ï≤´ Î≤àÏß∏ Ïã≠ÏÑ±
                            const lastDataRow = currentRows[currentRows.length - 1];
                            const firstDataRow = nextRows[1]; // Í∞ÑÏßÄ Ìñâ Ï†úÏô∏
                            
                            console.log('ÎßàÏßÄÎßâ Ìñâ:', lastDataRow);
                            console.log('Ï≤´ Îç∞Ïù¥ÌÑ∞ Ìñâ:', firstDataRow);
                            
                            // Ïã≠ÏÑ± Ïà´Ïûê Ï∂îÏ∂ú
                            const lastSipseong = parseInt(lastDataRow.cells[1].textContent);
                            const firstSipseong = parseInt(firstDataRow.cells[1].textContent);
                            
                            console.log(`Ïã≠ÏÑ± ÎπÑÍµê: ${lastSipseong} ‚Üí ${firstSipseong}`);
                            
                            const derived = calculateDerived(lastSipseong, firstSipseong);
                            
                            if (derived) {
                                console.log(`‚úÖ ÌååÏÉùÏàò Î∞úÍ≤¨: ${derived}`);
                                
                                // Ï¶âÏãú ÌååÏÉùÏàò ÌëúÏãú ÌÖåÏä§Ìä∏
                                const testCells = currentTable.querySelectorAll('.derived-cell');
                                console.log('ÌååÏÉùÏàò ÏÖÄ Í∞úÏàò:', testCells.length);
                                
                                testCells.forEach((cell, idx) => {
                                    cell.textContent = derived;
                                    cell.style.backgroundColor = '#ffeb3b';
                                    cell.style.color = '#d84315';
                                    console.log(`ÏÖÄ ${idx}Ïóê ${derived} ÏÑ§Ï†ïÎê®`);
                                });
                                
                                const nextTestCells = nextTable.querySelectorAll('.derived-cell');
                                nextTestCells.forEach((cell, idx) => {
                                    cell.textContent = derived;
                                    cell.style.backgroundColor = '#ffeb3b';
                                    cell.style.color = '#d84315';
                                });
                            } else {
                                console.log('‚ùå ÌååÏÉùÏàò ÏóÜÏùå');
                            }
                        }
                    } else {
                        console.log('‚ùå ÌÖåÏù¥Î∏îÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                    }
                }
                console.log('=== ÌååÏÉùÏàò Í≥ÑÏÇ∞ ÏôÑÎ£å ===');
            }, 500);
        }
        
        // ÌÖåÏù¥Î∏îÏóê ÌååÏÉùÏàò Ï∂îÍ∞ÄÌïòÎäî Ìï®Ïàò
        function addDerivedToTable(table, derived, position) {
            const rows = table.querySelectorAll('tr');
            
            // Í∞Å ÌñâÏùò ÌååÏÉùÏàò ÏÖÄÏóê Í∞í Ï∂îÍ∞Ä
            rows.forEach((row, index) => {
                if (index === 0) {
                    // Í∞ÑÏßÄ Ìñâ - colspan Ï°∞Ï†ï
                    const ganziCell = row.querySelector('td');
                    if (ganziCell && position === 'right') {
                        ganziCell.colSpan = 7; // ÏñëÏ™Ω ÌååÏÉùÏàò ÏÖÄ Ìè¨Ìï®
                    }
                } else {
                    // Îç∞Ïù¥ÌÑ∞ ÌñâÏùò ÌååÏÉùÏàò ÏÖÄÏóê Í∞í ÏÑ§Ï†ï
                    const derivedCells = row.querySelectorAll('.derived-cell');
                    if (derivedCells.length >= 2) {
                        if (index === 1) { // Ï≤´ Î≤àÏß∏ Îç∞Ïù¥ÌÑ∞ ÌñâÏóêÎßå ÌååÏÉùÏàò ÌëúÏãú
                            derivedCells[0].textContent = derived; // ÏôºÏ™Ω
                            derivedCells[1].textContent = derived; // Ïò§Î•∏Ï™Ω
                        }
                    }
                }
            });
        }
        
        // ÏûêÏùå Î∂ÑÌï¥ Í≥ºÏ†ï ÌÜ†Í∏Ä Ìï®Ïàò
        function toggleDetails(charId) {
            const detailsElement = document.getElementById('details-' + charId);
            const toggleButton = event.target;
            
            if (detailsElement.classList.contains('show')) {
                // Ïà®Í∏∞Í∏∞
                detailsElement.classList.remove('show');
                // Î≤ÑÌäº ÌÖçÏä§Ìä∏ÏóêÏÑú Í∏ÄÏûê Ï†ïÎ≥¥ Ï∂îÏ∂úÌïòÏó¨ Îã§Ïãú ÏÑ§Ï†ï
                const buttonText = toggleButton.textContent;
                const charInfo = buttonText.match(/üîç "(.)" Î∂ÑÏÑù \((\d+Ìöç - \w+)\)/);
                if (charInfo) {
                    toggleButton.textContent = `üîç "${charInfo[1]}" Î∂ÑÏÑù (${charInfo[2]}) ÏûêÏùå Î∂ÑÌï¥ Í≥ºÏ†ï Î≥¥Í∏∞`;
                }
                toggleButton.classList.remove('active');
            } else {
                // Î≥¥Ïù¥Í∏∞
                detailsElement.classList.add('show');
                // Î≤ÑÌäº ÌÖçÏä§Ìä∏ÏóêÏÑú Í∏ÄÏûê Ï†ïÎ≥¥ Ï∂îÏ∂úÌïòÏó¨ Îã§Ïãú ÏÑ§Ï†ï
                const buttonText = toggleButton.textContent;
                const charInfo = buttonText.match(/üîç "(.)" Î∂ÑÏÑù \((\d+Ìöç - \w+)\)/);
                if (charInfo) {
                    toggleButton.textContent = `üìÅ "${charInfo[1]}" Î∂ÑÏÑù (${charInfo[2]}) ÏûêÏùå Î∂ÑÌï¥ Í≥ºÏ†ï Ïà®Í∏∞Í∏∞`;
                }
                toggleButton.classList.add('active');
            }
        }
        function newAnalysis() {
            const inputSection = document.getElementById('inputSection');
            const resultSection = document.getElementById('result');
            
            // ÏûÖÎ†•Ï∞Ω Îã§Ïãú Î≥¥Ïù¥Í∏∞ (ÏïàÏ†ÑÌïú Ï≤¥ÌÅ¨)
            if (inputSection) {
                inputSection.classList.remove('hidden');
            }
            
            // Í≤∞Í≥º Ïà®Í∏∞Í∏∞
            if (resultSection) {
                resultSection.innerHTML = '';
            }
            
            // ÏûÖÎ†•Ï∞Ω Ï¥àÍ∏∞Ìôî
            const nameInput = document.getElementById('nameInput');
            const yearInput = document.getElementById('yearInput');
            
            if (nameInput) nameInput.value = '';
            if (yearInput) yearInput.value = '';
            
            // ÏûÖÎ†•Ï∞ΩÏúºÎ°ú Ïä§ÌÅ¨Î°§
            if (inputSection) {
                inputSection.scrollIntoView({behavior: 'smooth'});
                
                // Ïù¥Î¶Ñ ÏûÖÎ†•Ï∞ΩÏóê Ìè¨Ïª§Ïä§
                if (nameInput) {
                    setTimeout(() => nameInput.focus(), 500);
                }
            }
        }
    </script>
</body>
</html>
