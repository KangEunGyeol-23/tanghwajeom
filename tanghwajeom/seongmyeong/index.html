<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>성명학 분석 도구</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffa726);
            color: white;
            text-align: center;
            padding: 40px 20px;
        }
        
        .title {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            letter-spacing: 1px;
        }
        
        .input-section {
            padding: 40px;
            background: white;
            transition: all 0.5s ease;
        }
        
        .input-section.hidden {
            display: none;
        }
        
        .input-group {
            margin-bottom: 30px;
        }
        
        .input-group label {
            display: block;
            font-size: 1.1em;
            color: #444;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .input-group input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1em;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            color: #333;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #007bff;
            background: white;
            box-shadow: 0 0 20px rgba(0, 123, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .analyze-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.2em;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .analyze-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
        }
        
        .result {
            background: white;
            padding: 40px;
        }
        
        .result-title {
            text-align: center;
            font-size: 2.5em;
            color: #333;
            font-weight: 700;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .ganzi-info {
            text-align: center;
            font-size: 1.8em;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            border-radius: 15px;
            color: #8b4513;
            font-weight: 700;
        }
        
        .char-analysis {
            margin-bottom: 30px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .char-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            background: white;
            margin-bottom: 20px;
            table-layout: fixed;
        }
        
        .char-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            width: 14.28%;
            vertical-align: middle;
        }
        
        .ganzi-header {
            background: #6db4e8;
            color: white;
            height: 40px;
            font-size: 1.1em;
        }
        
        .derived-row {
            background: #e8eaf0;
            height: 35px;
        }
        
        .derived-cell {
            color: #d32f2f;
            font-size: 0.8em;
        }
        
        .cheoNeul-text {
            color: #1976d2;
            font-size: 0.7em;
            font-weight: bold;
        }
        
        .chung-text {
            color: #7b1fa2;
            font-size: 0.7em;
            font-weight: bold;
        }
        
        .sipseong-row {
            background: white;
            height: 60px;
            font-size: 1.2em;
        }
        
        .sipseong-number {
            color: #d32f2f;
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .char-cell {
            font-size: 3rem !important;
            background: #f8f9fa !important;
            font-weight: 900 !important;
            vertical-align: middle !important;
            text-align: center !important;
            height: 120px !important;
            line-height: 1 !important;
            padding: 0 !important;
            overflow: visible !important;
            position: relative !important;
            min-width: 80px !important;
        }
        
        .cheongan-row {
            background: #f0f0f0;
            height: 35px;
        }
        
        .jiji-row {
            background: #e8f4f8;
            height: 35px;
        }
        
        .buttons {
            text-align: center;
            margin-top: 30px;
        }
        
        .derived-toggle {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin-right: 15px;
            transition: all 0.3s ease;
        }
        
        .derived-toggle:hover {
            transform: translateY(-2px);
        }
        
        .derived-toggle.active {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .new-analysis-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .new-analysis-btn:hover {
            transform: translateY(-2px);
        }
        
        .derived-highlight {
            background: #ffd700 !important;
        }
        
        .stroke-info {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            text-align: center;
        }
        
        /* 기능 소개 섹션 */
        .features-section {
            margin-top: 50px;
            text-align: center;
        }
        
        .features-section h3 {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 30px;
            font-weight: 600;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #e9ecef;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }
        
        .feature-card h4 {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .feature-card p {
            font-size: 0.9em;
            color: #666;
            line-height: 1.5;
        }
        
        /* 사용법 안내 */
        .guide-section {
            margin-top: 50px;
            text-align: center;
        }
        
        .guide-section h3 {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 30px;
            font-weight: 600;
        }
        
        .guide-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .step {
            display: flex;
            align-items: center;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }
        
        .step:hover {
            transform: translateY(-3px);
        }
        
        .step-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .step p {
            font-size: 0.95em;
            color: #555;
            margin: 0;
            line-height: 1.4;
        }
        
        /* 모바일 반응형 */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header button {
                position: absolute !important;
                left: 10px !important;
                top: 15px !important;
                padding: 8px 12px !important;
                font-size: 14px !important;
            }
            
            .title {
                font-size: 2em !important;
                margin-top: 20px;
            }
            
            .input-section, .result {
                padding: 20px !important;
            }
            
            .char-table {
                font-size: 0.8em;
                table-layout: auto;
            }
            
            .char-cell {
                font-size: 2rem !important;
                height: 80px !important;
                min-width: 60px !important;
            }
            
            .sipseong-number {
                font-size: 1.4em !important;
            }
            
            .cheoNeul-text, .chung-text {
                font-size: 0.6em !important;
            }
            
            .ganzi-info {
                font-size: 1.4em !important;
                padding: 20px !important;
            }
            
            .buttons {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .derived-toggle, .new-analysis-btn {
                width: 100%;
                margin: 0 !important;
                padding: 12px !important;
                font-size: 1em !important;
            }
            
            .features-grid, .guide-steps {
                grid-template-columns: 1fr !important;
            }
            
            .char-table td {
                padding: 4px !important;
                font-size: 0.9em;
            }
            
            .stroke-info {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button onclick="goBack()" style="position: absolute; left: 20px; top: 20px; background: rgba(255,255,255,0.2); border: none; color: white; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-size: 16px;">⬅️ 돌아가기</button>
            <h1 class="title">🔮 성명학 분석</h1>
            <p class="subtitle">이름과 생년월일로 운명을 읽다</p>
        </div>
        
        <div class="input-section" id="inputSection">
            <div class="input-group">
                <label for="nameInput">이름</label>
                <input type="text" id="nameInput" placeholder="이름을 입력하세요 (예: 홍길동)" maxlength="5">
            </div>
            
            <div class="input-group">
                <label for="yearInput">태어난 년도</label>
                <input type="number" id="yearInput" placeholder="년도를 입력하세요 (예: 1990)" min="1900" max="2025">
            </div>
            
            <button class="analyze-btn" onclick="analyzeName()">🌟 성명학 분석하기</button>
            
            <!-- 기능 소개 섹션 -->
            <div class="features-section">
                <h3>🔍 분석 내용</h3>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">🎯</div>
                        <h4>십성 분석</h4>
                        <p>이름의 자음을 오행으로 변환하여 천간과의 관계를 분석합니다</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">⚡</div>
                        <h4>파생수 계산</h4>
                        <p>십성 간의 상극 관계에서 나타나는 파생수를 표시합니다</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🌟</div>
                        <h4>간지 분석</h4>
                        <p>태어난 해의 간지(천간+지지)를 기준으로 운명을 해석합니다</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">📊</div>
                        <h4>음양 판단</h4>
                        <p>총 획수로 음양을 결정하여 정확한 오행 배치를 계산합니다</p>
                    </div>
                </div>
            </div>
            
            <!-- 사용법 안내 -->
            <div class="guide-section">
                <h3>📖 사용 방법</h3>
                <div class="guide-steps">
                    <div class="step">
                        <span class="step-number">1</span>
                        <p>한글 이름을 정확히 입력하세요</p>
                    </div>
                    <div class="step">
                        <span class="step-number">2</span>
                        <p>태어난 년도를 4자리로 입력하세요</p>
                    </div>
                    <div class="step">
                        <span class="step-number">3</span>
                        <p>분석 버튼을 클릭하여 결과를 확인하세요</p>
                    </div>
                    <div class="step">
                        <span class="step-number">4</span>
                        <p>파생수 버튼으로 추가 정보를 확인하세요</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="result"></div>
    </div>

    <script>
        // 자음 획수
        const consonantStrokes = {
            'ㄱ': 1, 'ㄴ': 1, 'ㄷ': 2, 'ㄹ': 3, 'ㅁ': 3, 'ㅂ': 4, 'ㅅ': 2,
            'ㅇ': 1, 'ㅈ': 3, 'ㅊ': 4, 'ㅋ': 2, 'ㅌ': 3, 'ㅍ': 4, 'ㅎ': 3
        };
        
        // 모음 획수
        const vowelStrokes = {
            'ㅏ': 2, 'ㅑ': 3, 'ㅓ': 2, 'ㅕ': 3, 'ㅗ': 2, 'ㅛ': 3, 
            'ㅜ': 2, 'ㅠ': 3, 'ㅡ': 1, 'ㅣ': 1, 'ㅐ': 3, 'ㅒ': 4, 
            'ㅔ': 3, 'ㅖ': 4, 'ㅘ': 4, 'ㅙ': 5, 'ㅚ': 4, 'ㅝ': 4, 
            'ㅞ': 5, 'ㅟ': 4, 'ㅢ': 2
        };
        
        // 자음 → 오행 분류
        const consonantToElement = {
            'ㄱ': '木', 'ㅋ': '木',
            'ㄴ': '火', 'ㄷ': '火', 'ㄹ': '火', 'ㅌ': '火',
            'ㅇ': '土', 'ㅎ': '土',
            'ㅅ': '金', 'ㅈ': '金', 'ㅊ': '金',
            'ㅁ': '水', 'ㅂ': '水', 'ㅍ': '水'
        };
        
        // 십성 이름
        const sipseongNames = [
            '정인', '비견', '겁재', '식신', '상관', '편재', '정재', '편관', '정관', '편인'
        ];
        
        // 천을귀인표
        const cheonEulGuiIn = {
            '甲': ['丑', '未'], '乙': ['申', '子'], '丙': ['酉', '亥'], '丁': ['亥', '酉'],
            '戊': ['丑', '未'], '己': ['子', '申'], '庚': ['丑', '未'], '辛': ['寅', '午'],
            '壬': ['卯', '巳'], '癸': ['巳', '卯']
        };
        
        // 귀문관살 쌍
        const guimunGwansal = [
            ['子', '酉'], ['丑', '午'], ['寅', '未'], 
            ['卯', '申'], ['辰', '亥'], ['巳', '戌']
        ];
        
        // 공망표 (60갑자 기준)
        const gongmang = {
            '갑자~계유': ['戌', '亥'],
            '갑술~계미': ['申', '酉'], 
            '갑신~계사': ['午', '未'],
            '갑오~계묘': ['辰', '巳'],
            '갑진~계축': ['寅', '卯'],
            '갑인~계해': ['子', '丑']
        };
        
        // 60갑자 순서
        const sixtyGapja = [
            '甲子','乙丑','丙寅','丁卯','戊辰','己巳','庚午','辛未','壬申','癸酉', // 1-10
            '甲戌','乙亥','丙子','丁丑','戊寅','己卯','庚辰','辛巳','壬午','癸未', // 11-20  
            '甲申','乙酉','丙戌','丁亥','戊子','己丑','庚寅','辛卯','壬辰','癸巳', // 21-30
            '甲午','乙未','丙申','丁酉','戊戌','己亥','庚子','辛丑','壬寅','癸卯', // 31-40
            '甲辰','乙巳','丙午','丁未','戊申','己酉','庚戌','辛亥','壬子','癸丑', // 41-50
            '甲寅','乙卯','丙辰','丁巳','戊午','己未','庚申','辛酉','壬戌','癸亥'  // 51-60
        ];
        
        // 충(沖) 쌍
        const chungPairs = [
            ['寅', '申'], ['卯', '酉'], ['辰', '戌'], 
            ['巳', '亥'], ['午', '子'], ['未', '丑']
        ];
        
        // 충 확인
        function checkChung(yearJiji, nameJiji) {
            return chungPairs.some(pair => 
                (pair[0] === yearJiji && pair[1] === nameJiji) ||
                (pair[1] === yearJiji && pair[0] === nameJiji)
            );
        }
        
        // 귀문관살 확인
        function checkGuimunGwansal(yearJiji, nameJiji) {
            return guimunGwansal.some(pair => 
                (pair[0] === yearJiji && pair[1] === nameJiji) ||
                (pair[1] === yearJiji && pair[0] === nameJiji)
            );
        }
        
        // 공망 확인
        function getGongmang(yearGanJi) {
            const index = sixtyGapja.indexOf(yearGanJi);
            if (index === -1) return [];
            
            const groupIndex = Math.floor(index / 10);
            const gongmangGroups = [
                ['戌', '亥'], ['申', '酉'], ['午', '未'], 
                ['辰', '巳'], ['寅', '卯'], ['子', '丑']
            ];
            
            return gongmangGroups[groupIndex] || [];
        }
        
        // 토의 지지 변환 (음양권 고려)
        function convertToJijiWithSeason(cheongan, yearJiji) {
            // 년도 지지의 음양권 판단
            const yangGwon = ['寅', '卯', '辰', '巳', '午', '未']; // 봄, 여름
            const eumGwon = ['申', '酉', '戌', '亥', '子', '丑']; // 가을, 겨울
            
            const isYangGwon = yangGwon.includes(yearJiji);
            
            const conversion = {
                '甲': '寅', '乙': '卯', '丙': '巳', '丁': '午', 
                '壬': '亥', '癸': '子',
                '庚': '申', '辛': '酉'
            };
            
            // 토는 특별 처리
            if (cheongan === '戊') {
                return isYangGwon ? '辰' : '戌';
            } else if (cheongan === '己') {
                return isYangGwon ? '未' : '丑';
            }
            
            return conversion[cheongan] || '';
        }
        
        // 한글 분해
        function hangulDecompose(char) {
            const charCode = char.charCodeAt(0);
            if (charCode < 0xAC00 || charCode > 0xD7A3) return null;
            
            const index = charCode - 0xAC00;
            const initial = Math.floor(index / 588);
            const medial = Math.floor((index % 588) / 28);
            const final = index % 28;
            
            const initials = ['ㄱ','ㄲ','ㄴ','ㄷ','ㄸ','ㄹ','ㅁ','ㅂ','ㅃ','ㅅ','ㅆ','ㅇ','ㅈ','ㅉ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];
            const medials = ['ㅏ','ㅐ','ㅑ','ㅒ','ㅓ','ㅔ','ㅕ','ㅖ','ㅗ','ㅘ','ㅙ','ㅚ','ㅛ','ㅜ','ㅝ','ㅞ','ㅟ','ㅠ','ㅡ','ㅢ','ㅣ'];
            const finals = ['','ㄱ','ㄲ','ㄱㅅ','ㄴ','ㄴㅈ','ㄴㅎ','ㄷ','ㄹ','ㄹㄱ','ㄹㅁ','ㄹㅂ','ㄹㅅ','ㄹㅌ','ㄹㅍ','ㄹㅎ','ㅁ','ㅂ','ㅂㅅ','ㅅ','ㅆ','ㅇ','ㅈ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];
            
            return {
                initial: initials[initial],
                medial: medials[medial],
                final: final === 0 ? '' : finals[final]
            };
        }
        
        // 간지 계산
        function getGanJi(year) {
            const ganHanja = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
            const jiHanja = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
            const ganKorean = ['갑', '을', '병', '정', '무', '기', '경', '신', '임', '계'];
            const jiKorean = ['자', '축', '인', '묘', '진', '사', '오', '미', '신', '유', '술', '해'];
            
            const baseYear = 1984;
            const yearDiff = year - baseYear;
            
            let ganIndex = yearDiff % 10;
            let jiIndex = yearDiff % 12;
            
            if (ganIndex < 0) ganIndex += 10;
            if (jiIndex < 0) jiIndex += 12;
            
            return {
                ganHanja: ganHanja[ganIndex],
                jiHanja: jiHanja[jiIndex],
                fullKorean: ganKorean[ganIndex] + jiKorean[jiIndex] + '년'
            };
        }
        
        // 십성 계산
        function calculateSipseong(myElement, myYinYang, targetElement, targetYinYang) {
            const relations = {
                '木': { generates: '火', destroys: '土', generatedBy: '水', destroyedBy: '金' },
                '火': { generates: '土', destroys: '金', generatedBy: '木', destroyedBy: '水' },
                '土': { generates: '金', destroys: '水', generatedBy: '火', destroyedBy: '木' },
                '金': { generates: '水', destroys: '木', generatedBy: '土', destroyedBy: '火' },
                '水': { generates: '木', destroys: '火', generatedBy: '金', destroyedBy: '土' }
            };
            
            if (!relations[targetElement] || !relations[myElement]) {
                return 0;
            }
            
            const sameYinYang = myYinYang === targetYinYang;
            
            if (myElement === targetElement) {
                // 나와 같은 오행
                return sameYinYang ? 1 : 2; // 비견(1) : 겁재(2)
            } else if (relations[targetElement].generates === myElement) {
                // 나를 생하는 오행
                return sameYinYang ? 9 : 0; // 편인(9) : 정인(0)
            } else if (relations[myElement].generates === targetElement) {
                // 내가 생하는 오행
                return sameYinYang ? 3 : 4; // 식신(3) : 상관(4)
            } else if (relations[targetElement].destroys === myElement) {
                // 나를 극하는 오행
                return sameYinYang ? 7 : 8; // 편관(7) : 정관(8)
            } else if (relations[myElement].destroys === targetElement) {
                // 내가 극하는 오행
                return sameYinYang ? 5 : 6; // 편재(5) : 정재(6)
            }
            
            return 0;
        }
        
        // 한자에서 오행 추출
        function getElementFromHanja(hanja) {
            const hanjaToElement = {
                '甲': '木', '乙': '木', '丙': '火', '丁': '火', 
                '戊': '土', '己': '土', '庚': '金', '辛': '金',
                '壬': '水', '癸': '水',
                '子': '水', '丑': '土', '寅': '木', '卯': '木', 
                '辰': '土', '巳': '火', '午': '火', '未': '土',
                '申': '金', '酉': '金', '戌': '土', '亥': '水'
            };
            return hanjaToElement[hanja] || '土';
        }
        
        // 한자 음양 판단
        function getYinYangFromHanja(hanja) {
            const yangHanja = ['甲','丙','戊','庚','壬','寅','辰','午','申','戌'];
            return yangHanja.includes(hanja) ? 'yang' : 'eum';
        }
        
        function analyzeName() {
            const name = document.getElementById('nameInput').value.trim();
            const year = parseInt(document.getElementById('yearInput').value);
            
            if (!name || !year) {
                alert('이름과 태어난 년도를 모두 입력해주세요.');
                return;
            }
            
            document.getElementById('inputSection').classList.add('hidden');
            
            const ganJi = getGanJi(year);
            const ganElement = getElementFromHanja(ganJi.ganHanja);
            const jiElement = getElementFromHanja(ganJi.jiHanja);
            const ganYinYang = getYinYangFromHanja(ganJi.ganHanja);
            const jiYinYang = getYinYangFromHanja(ganJi.jiHanja);
            
            let resultHTML = `
                <div class="result">
                    <div class="result-title">🔮 ${name}님의 성명학 분석 결과</div>
                    <div class="ganzi-info">
                        <strong>태어난 해:</strong> ${year}년 ${ganJi.fullKorean} (${ganJi.ganHanja}${ganJi.jiHanja})
                    </div>
            `;
            
            const charDataList = [];
            
            for (let i = 0; i < name.length; i++) {
                const char = name[i];
                const decomposed = hangulDecompose(char);
                
                if (!decomposed) continue;
                
                const {initial, medial, final} = decomposed;
                
                let totalStrokes = 0;
                totalStrokes += consonantStrokes[initial] || 0;
                totalStrokes += vowelStrokes[medial] || 0;
                if (final) {
                    totalStrokes += consonantStrokes[final] || 0;
                }
                
                const isYang = totalStrokes % 2 === 1;
                const yinYangType = isYang ? 'yang' : 'eum';
                
                const consonants = [initial];
                if (final && final !== '') {
                    consonants.push(final);
                }
                
                const charData = {
                    char: char,
                    totalStrokes: totalStrokes,
                    isYang: isYang,
                    consonants: consonants,
                    sipseongData: []
                };
                
                consonants.forEach(consonant => {
                    const element = consonantToElement[consonant];
                    if (element) {
                        const cheongan = isYang ? 
                            (element === '木' ? '甲' : element === '火' ? '丙' : element === '土' ? '戊' : element === '金' ? '庚' : '壬') :
                            (element === '木' ? '乙' : element === '火' ? '丁' : element === '土' ? '己' : element === '金' ? '辛' : '癸');
                        
                        const myElement = element;
                        const myYinYang = yinYangType;
                        
                        const ganSipseong = calculateSipseong(myElement, myYinYang, ganElement, ganYinYang);
                        const jiSipseong = calculateSipseong(myElement, myYinYang, jiElement, jiYinYang);
                        
                        charData.sipseongData.push({
                            consonant: consonant,
                            element: element,
                            cheongan: cheongan,
                            ganSipseong: ganSipseong,
                            jiSipseong: jiSipseong,
                            jiji: convertToJijiWithSeason(cheongan, ganJi.jiHanja)
                        });
                    }
                });
                
                charDataList.push(charData);
                
                let tableHTML = `
                    <div class="char-analysis">
                        <div class="stroke-info">${char}자: ${totalStrokes}획 (${isYang ? '양' : '음'})</div>
                        <table class="char-table" data-char="${char}" data-char-index="${i}">
                            <tr>
                                <td colspan="7" class="ganzi-header">${ganJi.ganHanja} ${ganJi.jiHanja}</td>
                            </tr>
                            <tr class="derived-row">
                                <td class="derived-cell derived-left-cell">P</td>
                                <td class="derived-cell"></td>
                                <td class="derived-cell"></td>
                                <td class="derived-cell"></td>
                                <td class="derived-cell"></td>
                                <td class="derived-cell"></td>
                                <td class="derived-cell derived-right-cell">P</td>
                            </tr>
                `;
                
                charData.sipseongData.forEach((sipseongInfo, index) => {
                    // 천을귀인 확인
                    const yearGanGuiIn = cheonEulGuiIn[ganJi.ganHanja] || [];
                    const yearJiGuiIn = cheonEulGuiIn[ganJi.jiHanja] || [];
                    
                    const hasLeftCheonEul = yearGanGuiIn.includes(sipseongInfo.jiji);
                    const hasRightCheonEul = yearJiGuiIn.includes(sipseongInfo.jiji);
                    
                    // 귀문관살 확인
                    const hasLeftGuimun = checkGuimunGwansal(ganJi.jiHanja, sipseongInfo.jiji);
                    const hasRightGuimun = checkGuimunGwansal(ganJi.jiHanja, sipseongInfo.jiji);
                    
                    // 공망 확인
                    const yearGongmang = getGongmang(ganJi.ganHanja + ganJi.jiHanja);
                    const hasLeftGongmang = yearGongmang.includes(sipseongInfo.jiji);
                    const hasRightGongmang = yearGongmang.includes(sipseongInfo.jiji);
                    
                    // 충 확인
                    const hasLeftChung = checkChung(ganJi.jiHanja, sipseongInfo.jiji);
                    const hasRightChung = checkChung(ganJi.jiHanja, sipseongInfo.jiji);
                    
                    // 표시 텍스트 조합
                    let leftSpecialText = '';
                    let rightSpecialText = '';
                    
                    // 파란색 텍스트들
                    if (hasLeftCheonEul) leftSpecialText += '천을';
                    if (hasLeftGuimun) {
                        if (leftSpecialText) leftSpecialText += '<br>';
                        leftSpecialText += '귀문';
                    }
                    if (hasLeftGongmang) {
                        if (leftSpecialText) leftSpecialText += '<br>';
                        leftSpecialText += '공망';
                    }
                    
                    if (hasRightCheonEul) rightSpecialText += '천을';
                    if (hasRightGuimun) {
                        if (rightSpecialText) rightSpecialText += '<br>';
                        rightSpecialText += '귀문';
                    }
                    if (hasRightGongmang) {
                        if (rightSpecialText) rightSpecialText += '<br>';
                        rightSpecialText += '공망';
                    }
                    
                    // 보라색 충 텍스트
                    let leftChungText = hasLeftChung ? '충' : '';
                    let rightChungText = hasRightChung ? '충' : '';
                    
                    if (index === 0) {
                        const rowSpan = charData.sipseongData.length;
                        tableHTML += `
                            <tr class="sipseong-row" data-left-sipseong="${sipseongInfo.ganSipseong}" data-right-sipseong="${sipseongInfo.jiSipseong}">
                                <td class="derived-left-cell"></td>
                                <td class="sipseong-number">${sipseongInfo.ganSipseong}${leftSpecialText ? '<br><span class="cheoNeul-text">' + leftSpecialText + '</span>' : ''}${leftChungText ? '<br><span class="chung-text">' + leftChungText + '</span>' : ''}</td>
                                <td>${sipseongNames[sipseongInfo.ganSipseong]}</td>
                                <td class="char-cell" rowspan="${rowSpan}">${char}</td>
                                <td>${sipseongNames[sipseongInfo.jiSipseong]}</td>
                                <td class="sipseong-number">${sipseongInfo.jiSipseong}${rightSpecialText ? '<br><span class="cheoNeul-text">' + rightSpecialText + '</span>' : ''}${rightChungText ? '<br><span class="chung-text">' + rightChungText + '</span>' : ''}</td>
                                <td class="derived-right-cell"></td>
                            </tr>
                        `;
                    } else {
                        tableHTML += `
                            <tr class="sipseong-row" data-left-sipseong="${sipseongInfo.ganSipseong}" data-right-sipseong="${sipseongInfo.jiSipseong}">
                                <td class="derived-left-cell"></td>
                                <td class="sipseong-number">${sipseongInfo.ganSipseong}${leftSpecialText ? '<br><span class="cheoNeul-text">' + leftSpecialText + '</span>' : ''}${leftChungText ? '<br><span class="chung-text">' + leftChungText + '</span>' : ''}</td>
                                <td>${sipseongNames[sipseongInfo.ganSipseong]}</td>
                                <td>${sipseongNames[sipseongInfo.jiSipseong]}</td>
                                <td class="sipseong-number">${sipseongInfo.jiSipseong}${rightSpecialText ? '<br><span class="cheoNeul-text">' + rightSpecialText + '</span>' : ''}${rightChungText ? '<br><span class="chung-text">' + rightChungText + '</span>' : ''}</td>
                                <td class="derived-right-cell"></td>
                            </tr>
                        `;
                    }
                });
                
                const cheonganList = charData.sipseongData.map(data => data.cheongan);
                tableHTML += `
                    <tr class="cheongan-row">
                        <td colspan="7">${cheonganList.join('')}</td>
                    </tr>
                </table>
                </div>
                `;
                
                resultHTML += tableHTML;
            }
            
            resultHTML += `
                <div class="buttons">
                    <button class="derived-toggle" onclick="toggleDerived()">🔢 파생수 보기/숨기기</button>
                    <button class="new-analysis-btn" onclick="newAnalysis()">🔄 새로운 분석하기</button>
                </div>
                </div>
            `;
            
            document.getElementById('result').innerHTML = resultHTML;
            
            // 전역 변수에 저장
            window.charDataList = charDataList;
            window.birthYear = year; // 태어난 년도 저장
        }
        
        // 십성 그룹 판별
        function getSipseongGroup(sipseong) {
            if ([1, 2].includes(sipseong)) return 'bijup'; // 비겁
            if ([3, 4].includes(sipseong)) return 'siksang'; // 식상
            if ([5, 6].includes(sipseong)) return 'jaeseong'; // 재성
            if ([7, 8].includes(sipseong)) return 'gwanseong'; // 관성
            if ([9, 0].includes(sipseong)) return 'inseong'; // 인성
            return 'unknown';
        }
        
        // 상극 관계 확인
        function isGeukRelation(group1, group2) {
            const geukMap = {
                'bijup': 'jaeseong',    // 비겁 → 재성 극
                'jaeseong': 'inseong',  // 재성 → 인성 극
                'inseong': 'siksang',   // 인성 → 식상 극
                'siksang': 'gwanseong', // 식상 → 관성 극
                'gwanseong': 'bijup'    // 관성 → 비겁 극
            };
            
            return geukMap[group1] === group2 || geukMap[group2] === group1;
        }
        
        // 극당하는 그룹이 도망가는 대상
        function getEscapeTarget(attackedGroup) {
            const escapeMap = {
                'bijup': [5, 6],      // 비겁 극당함 → 재성으로 도망
                'jaeseong': [9, 0],   // 재성 극당함 → 인성으로 도망
                'inseong': [3, 4],    // 인성 극당함 → 식상으로 도망
                'siksang': [7, 8],    // 식상 극당함 → 관성으로 도망
                'gwanseong': [1, 2]   // 관성 극당함 → 비겁으로 도망
            };
            return escapeMap[attackedGroup] || [];
        }
        
        function toggleDerived() {
            const button = document.querySelector('.derived-toggle');
            const isActive = button.classList.contains('active');
            
            if (!isActive) {
                // 파생수 보이기
                const charDataList = window.charDataList || [];
                
                // 각 글자별 파생수 계산
                charDataList.forEach((charData, charIndex) => {
                    const table = document.querySelector(`[data-char-index="${charIndex}"]`);
                    if (!table) return;
                    
                    const leftSipseongs = charData.sipseongData.map(data => data.ganSipseong);
                    const rightSipseongs = charData.sipseongData.map(data => data.jiSipseong);
                    
                    // 왼쪽 세로 파생수 계산
                    for (let i = 0; i < leftSipseongs.length - 1; i++) {
                        const current = leftSipseongs[i];
                        const next = leftSipseongs[i + 1];
                        
                        const currentGroup = getSipseongGroup(current);
                        const nextGroup = getSipseongGroup(next);
                        
                        if (isGeukRelation(currentGroup, nextGroup)) {
                            // 어느 쪽이 극당하는지 판단
                            const geukMap = {
                                'bijup': 'jaeseong',
                                'jaeseong': 'inseong',
                                'inseong': 'siksang',
                                'siksang': 'gwanseong',
                                'gwanseong': 'bijup'
                            };
                            
                            let attackedGroup;
                            if (geukMap[currentGroup] === nextGroup) {
                                attackedGroup = nextGroup; // current가 next를 극함
                            } else {
                                attackedGroup = currentGroup; // next가 current를 극함
                            }
                            
                            const escapeTarget = getEscapeTarget(attackedGroup);
                            const derivedText = escapeTarget.join(',');
                            
                            // 해당 행의 왼쪽 파생수 셀에 표시
                            const rows = table.querySelectorAll('.sipseong-row');
                            if (rows[i]) {
                                const leftCell = rows[i].querySelector('.derived-left-cell');
                                if (leftCell) {
                                    leftCell.textContent = derivedText;
                                    leftCell.classList.add('derived-highlight');
                                }
                            }
                        }
                    }
                    
                    // 오른쪽 세로 파생수 계산
                    for (let i = 0; i < rightSipseongs.length - 1; i++) {
                        const current = rightSipseongs[i];
                        const next = rightSipseongs[i + 1];
                        
                        const currentGroup = getSipseongGroup(current);
                        const nextGroup = getSipseongGroup(next);
                        
                        if (isGeukRelation(currentGroup, nextGroup)) {
                            const geukMap = {
                                'bijup': 'jaeseong',
                                'jaeseong': 'inseong',
                                'inseong': 'siksang',
                                'siksang': 'gwanseong',
                                'gwanseong': 'bijup'
                            };
                            
                            let attackedGroup;
                            if (geukMap[currentGroup] === nextGroup) {
                                attackedGroup = nextGroup;
                            } else {
                                attackedGroup = currentGroup;
                            }
                            
                            const escapeTarget = getEscapeTarget(attackedGroup);
                            const derivedText = escapeTarget.join(',');
                            
                            const rows = table.querySelectorAll('.sipseong-row');
                            if (rows[i]) {
                                const rightCell = rows[i].querySelector('.derived-right-cell');
                                if (rightCell) {
                                    rightCell.textContent = derivedText;
                                    rightCell.classList.add('derived-highlight');
                                }
                            }
                        }
                    }
                });
                
                // 글자 간 파생수 계산
                for (let charIndex = 0; charIndex < charDataList.length - 1; charIndex++) {
                    const currentChar = charDataList[charIndex];
                    const nextChar = charDataList[charIndex + 1];
                    
                    if (currentChar.sipseongData.length === 0 || nextChar.sipseongData.length === 0) continue;
                    
                    // 현재 글자의 마지막 십성들과 다음 글자의 첫 십성들 비교
                    const currentLastLeft = currentChar.sipseongData[currentChar.sipseongData.length - 1].ganSipseong;
                    const currentLastRight = currentChar.sipseongData[currentChar.sipseongData.length - 1].jiSipseong;
                    const nextFirstLeft = nextChar.sipseongData[0].ganSipseong;
                    const nextFirstRight = nextChar.sipseongData[0].jiSipseong;
                    
                    // 왼쪽 연결
                    const leftCurrentGroup = getSipseongGroup(currentLastLeft);
                    const leftNextGroup = getSipseongGroup(nextFirstLeft);
                    
                    if (isGeukRelation(leftCurrentGroup, leftNextGroup)) {
                        const geukMap = {
                            'bijup': 'jaeseong',
                            'jaeseong': 'inseong',
                            'inseong': 'siksang',
                            'siksang': 'gwanseong',
                            'gwanseong': 'bijup'
                        };
                        
                        let attackedGroup;
                        if (geukMap[leftCurrentGroup] === leftNextGroup) {
                            attackedGroup = leftNextGroup;
                        } else {
                            attackedGroup = leftCurrentGroup;
                        }
                        
                        const escapeTarget = getEscapeTarget(attackedGroup);
                        const derivedText = escapeTarget.join(',');
                        
                        // 현재 글자 오른쪽 끝 P에 표시
                        const currentTable = document.querySelector(`[data-char-index="${charIndex}"]`);
                        const currentRows = currentTable.querySelectorAll('.sipseong-row');
                        const currentLastRow = currentRows[currentRows.length - 1];
                        const currentRightCell = currentLastRow.querySelector('.derived-right-cell');
                        if (currentRightCell && currentRightCell.textContent === 'P') {
                            currentRightCell.textContent = derivedText;
                            currentRightCell.classList.add('derived-highlight');
                        }
                        
                        // 다음 글자 왼쪽 첫 P에 표시
                        const nextTable = document.querySelector(`[data-char-index="${charIndex + 1}"]`);
                        const nextRows = nextTable.querySelectorAll('.sipseong-row');
                        const nextFirstRow = nextRows[0];
                        const nextLeftCell = nextFirstRow.querySelector('.derived-left-cell');
                        if (nextLeftCell && nextLeftCell.textContent === 'P') {
                            nextLeftCell.textContent = derivedText;
                            nextLeftCell.classList.add('derived-highlight');
                        }
                    }
                    
                    // 오른쪽 연결
                    const rightCurrentGroup = getSipseongGroup(currentLastRight);
                    const rightNextGroup = getSipseongGroup(nextFirstRight);
                    
                    if (isGeukRelation(rightCurrentGroup, rightNextGroup)) {
                        const geukMap = {
                            'bijup': 'jaeseong',
                            'jaeseong': 'inseong',
                            'inseong': 'siksang',
                            'siksang': 'gwanseong',
                            'gwanseong': 'bijup'
                        };
                        
                        let attackedGroup;
                        if (geukMap[rightCurrentGroup] === rightNextGroup) {
                            attackedGroup = rightNextGroup;
                        } else {
                            attackedGroup = rightCurrentGroup;
                        }
                        
                        const escapeTarget = getEscapeTarget(attackedGroup);
                        const derivedText = escapeTarget.join(',');
                        
                        // 현재 글자 오른쪽 끝 P에 표시 (아직 표시 안된 경우)
                        const currentTable = document.querySelector(`[data-char-index="${charIndex}"]`);
                        const currentRows = currentTable.querySelectorAll('.sipseong-row');
                        const currentLastRow = currentRows[currentRows.length - 1];
                        const currentRightCell = currentLastRow.querySelector('.derived-right-cell');
                        if (currentRightCell && currentRightCell.textContent === 'P') {
                            currentRightCell.textContent = derivedText;
                            currentRightCell.classList.add('derived-highlight');
                        }
                        
                        // 다음 글자 왼쪽 첫 P에 표시 (아직 표시 안된 경우)
                        const nextTable = document.querySelector(`[data-char-index="${charIndex + 1}"]`);
                        const nextRows = nextTable.querySelectorAll('.sipseong-row');
                        const nextFirstRow = nextRows[0];
                        const nextLeftCell = nextFirstRow.querySelector('.derived-left-cell');
                        if (nextLeftCell && nextLeftCell.textContent === 'P') {
                            nextLeftCell.textContent = derivedText;
                            nextLeftCell.classList.add('derived-highlight');
                        }
                    }
                }
                
                button.textContent = '📁 파생수 숨기기';
                button.classList.add('active');
            } else {
                // 파생수 숨기기 - P로 복원
                const derivedCells = document.querySelectorAll('.derived-highlight');
                derivedCells.forEach(cell => {
                    cell.textContent = 'P';
                    cell.classList.remove('derived-highlight');
                });
                
                button.textContent = '🔢 파생수 보기/숨기기';
                button.classList.remove('active');
            }
        }
        
        function newAnalysis() {
            document.getElementById('inputSection').classList.remove('hidden');
            document.getElementById('result').innerHTML = '';
            document.getElementById('nameInput').value = '';
            document.getElementById('yearInput').value = '';
            document.getElementById('nameInput').focus();
            
            // 전역 변수 초기화
            window.charDataList = [];
        }
        
        function showSaeun() {
            // 세운 년도 입력 받기
            const year = prompt("세운을 보고 싶은 년도를 입력하세요 (예: 2025):");
            
            if (!year || isNaN(year)) {
                alert("올바른 년도를 입력해주세요.");
                return;
            }
            
            const saeunYear = parseInt(year);
            const saeunGanJi = getGanJi(saeunYear);
            
            // 태어난 년도 정보 가져오기 (전역 변수에서)
            const birthYear = parseInt(document.getElementById('yearInput').value) || window.birthYear;
            const birthGanJi = getGanJi(birthYear);
            
            // 세운 십성 계산
            const birthGanElement = getElementFromHanja(birthGanJi.ganHanja);
            const birthGanYinYang = getYinYangFromHanja(birthGanJi.ganHanja);
            const birthJiElement = getElementFromHanja(birthGanJi.jiHanja);
            const birthJiYinYang = getYinYangFromHanja(birthGanJi.jiHanja);
            
            const saeunGanElement = getElementFromHanja(saeunGanJi.ganHanja);
            const saeunGanYinYang = getYinYangFromHanja(saeunGanJi.ganHanja);
            const saeunJiElement = getElementFromHanja(saeunGanJi.jiHanja);
            const saeunJiYinYang = getYinYangFromHanja(saeunGanJi.jiHanja);
            
            // 4개 십성 계산 (태어난 년도 → 세운 년도 보기)
            const leftTop = calculateSipseong(birthGanElement, birthGanYinYang, saeunGanElement, saeunGanYinYang);    // 천간→천간
            const rightTop = calculateSipseong(birthGanElement, birthGanYinYang, saeunJiElement, saeunJiYinYang);     // 천간→지지
            const leftBottom = calculateSipseong(birthJiElement, birthJiYinYang, saeunGanElement, saeunGanYinYang);   // 지지→천간
            const rightBottom = calculateSipseong(birthJiElement, birthJiYinYang, saeunJiElement, saeunJiYinYang);    // 지지→지지
            
            // 특수신살 확인 (세운 기준)
            const saeunGanGuiIn = cheonEulGuiIn[birthGanJi.ganHanja] || [];
            const saeunJiGuiIn = cheonEulGuiIn[birthGanJi.jiHanja] || [];
            
            const hasLeftTopCheonEul = saeunGanGuiIn.includes(saeunGanJi.ganHanja);
            const hasRightTopCheonEul = saeunGanGuiIn.includes(saeunGanJi.jiHanja);
            const hasLeftBottomCheonEul = saeunJiGuiIn.includes(saeunGanJi.ganHanja);
            const hasRightBottomCheonEul = saeunJiGuiIn.includes(saeunGanJi.jiHanja);
            
            const hasLeftTopGuimun = checkGuimunGwansal(birthGanJi.jiHanja, saeunGanJi.ganHanja);
            const hasRightTopGuimun = checkGuimunGwansal(birthGanJi.jiHanja, saeunGanJi.jiHanja);
            const hasLeftBottomGuimun = checkGuimunGwansal(birthGanJi.jiHanja, saeunGanJi.ganHanja);
            const hasRightBottomGuimun = checkGuimunGwansal(birthGanJi.jiHanja, saeunGanJi.jiHanja);
            
            const yearGongmang = getGongmang(birthGanJi.ganHanja + birthGanJi.jiHanja);
            const hasLeftTopGongmang = yearGongmang.includes(saeunGanJi.ganHanja);
            const hasRightTopGongmang = yearGongmang.includes(saeunGanJi.jiHanja);
            const hasLeftBottomGongmang = yearGongmang.includes(saeunGanJi.ganHanja);
            const hasRightBottomGongmang = yearGongmang.includes(saeunGanJi.jiHanja);
            
            const hasLeftTopChung = checkChung(birthGanJi.jiHanja, saeunGanJi.ganHanja);
            const hasRightTopChung = checkChung(birthGanJi.jiHanja, saeunGanJi.jiHanja);
            const hasLeftBottomChung = checkChung(birthGanJi.jiHanja, saeunGanJi.ganHanja);
            const hasRightBottomChung = checkChung(birthGanJi.jiHanja, saeunGanJi.jiHanja);
            
            // 특수 텍스트 조합
            function getSpecialText(cheonEul, guimun, gongmang, chung) {
                let blueText = '';
                if (cheonEul) blueText += '천을';
                if (guimun) {
                    if (blueText) blueText += '<br>';
                    blueText += '귀문';
                }
                if (gongmang) {
                    if (blueText) blueText += '<br>';
                    blueText += '공망';
                }
                
                let purpleText = chung ? '충' : '';
                
                let result = '';
                if (blueText) result += '<br><span class="cheoNeul-text">' + blueText + '</span>';
                if (purpleText) result += '<br><span class="chung-text">' + purpleText + '</span>';
                
                return result;
            }
            
            // 세운 결과 표시
            const saeunHTML = `
                <div class="char-analysis" style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); border: 2px solid #2196f3;">
                    <h3 style="text-align: center; color: #1976d2; margin-bottom: 20px;">
                        📅 ${saeunYear}년 세운 (${birthYear}년생 기준)
                    </h3>
                    <table class="char-table">
                        <tr>
                            <td colspan="7" class="ganzi-header">${saeunGanJi.ganHanja} ${saeunGanJi.jiHanja}</td>
                        </tr>
                        <tr class="derived-row">
                            <td class="derived-cell derived-left-cell">P</td>
                            <td class="derived-cell"></td>
                            <td class="derived-cell"></td>
                            <td class="derived-cell"></td>
                            <td class="derived-cell"></td>
                            <td class="derived-cell"></td>
                            <td class="derived-cell derived-right-cell">P</td>
                        </tr>
                        <tr class="sipseong-row">
                            <td class="derived-left-cell"></td>
                            <td class="sipseong-number">${leftTop}${getSpecialText(hasLeftTopCheonEul, hasLeftTopGuimun, hasLeftTopGongmang, hasLeftTopChung)}</td>
                            <td>${sipseongNames[leftTop]}</td>
                            <td class="char-cell" rowspan="2">${saeunYear}년</td>
                            <td>${sipseongNames[rightTop]}</td>
                            <td class="sipseong-number">${rightTop}${getSpecialText(hasRightTopCheonEul, hasRightTopGuimun, hasRightTopGongmang, hasRightTopChung)}</td>
                            <td class="derived-right-cell"></td>
                        </tr>
                        <tr class="sipseong-row">
                            <td class="derived-left-cell"></td>
                            <td class="sipseong-number">${leftBottom}${getSpecialText(hasLeftBottomCheonEul, hasLeftBottomGuimun, hasLeftBottomGongmang, hasLeftBottomChung)}</td>
                            <td>${sipseongNames[leftBottom]}</td>
                            <td>${sipseongNames[rightBottom]}</td>
                            <td class="sipseong-number">${rightBottom}${getSpecialText(hasRightBottomCheonEul, hasRightBottomGuimun, hasRightBottomGongmang, hasRightBottomChung)}</td>
                            <td class="derived-right-cell"></td>
                        </tr>
                        <tr class="cheongan-row">
                            <td colspan="7">${saeunGanJi.ganHanja}${saeunGanJi.jiHanja}</td>
                        </tr>
                    </table>
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="toggleSaeunDerived(this)" class="derived-toggle" style="margin-right: 15px;">🔢 세운 파생수 보기</button>
                        <button onclick="closeSaeun()" class="new-analysis-btn" style="background: linear-gradient(135deg, #f44336, #d32f2f);">❌ 세운 닫기</button>
                    </div>
                </div>
            `;
            
            // 결과 영역 끝에 세운 추가
            const resultDiv = document.querySelector('.result');
            if (resultDiv) {
                resultDiv.insertAdjacentHTML('beforeend', saeunHTML);
                
                // 세운 결과로 스크롤
                document.querySelector('.char-analysis:last-child').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            }
        }
        
        function toggleSaeunDerived(button) {
            // 현재는 파생수가 자동으로 표시되므로 이 함수는 비활성화
            alert("세운 파생수는 자동으로 표시됩니다!");
        }
        
        function closeSaeun() {
            // 마지막 세운 결과 제거
            const saeunResults = document.querySelectorAll('.char-analysis');
            const lastSaeun = saeunResults[saeunResults.length - 1];
            
            // 세운 결과인지 확인 (제목에 "세운"이 포함된 경우)
            if (lastSaeun && lastSaeun.innerHTML.includes('세운')) {
                lastSaeun.remove();
            }
        }
        
        function goBack() {
            // 브라우저 뒤로 가기
            window.history.back();
            
            // 또는 특정 페이지로 이동하려면:
            // window.location.href = 'index.html'; // 웰컴페이지 파일명에 맞게 수정
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('nameInput');
            const yearInput = document.getElementById('yearInput');
            
            if (nameInput) {
                nameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        yearInput.focus();
                    }
                });
            }
            
            if (yearInput) {
                yearInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        analyzeName();
                    }
                });
            }
        });
    </script>
</body>
</html>
